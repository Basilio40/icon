{% extends 'base.html' %}

{% block content %}
{% load l10n %}
<br>
<br>
<hr>
<div class="btn-group mr-2"></div>
<div class="btn-group mr-2"></div>
<div class="btn-group mr-2"></div>
<div class="btn-group mr-2">
    <a href="{% url 'objetivos:objetivo_de_receitas' user=request.user%}" class="href"><button type="button" class="btn btn-sm btn-outline-info">Anterior</button></a>
    <a href="{% url 'objetivos:objetivo_de_custos' user=request.user%}" class="href"><button type="button" class="btn btn-sm btn-outline-info">Próximo</button></a>
    <a href="{% url 'graficos:ped_desempenho' user=request.user %}" class="href"><button type="button" class="btn btn-sm btn-outline-info">Menu</button></a>
</div>
<hr>
<div class="container">
      <div class="row">
          <div class="col-12">
              <div class="card">
                    <div class="card-header bg-info text-white">
                      <h2 class="text-center">Definindo Objetivos de Rentabilidade</h2>
                        <div class="card-header bg-info text-white">
                        <select class="selectpicker form-control form-control-lg">
                     <option data-content="<h5>Crescimento Sustentavel da Receita </h5>"></option>
                       <option data-content="<h5>Manutenção da Receita<h5>"></option>
                       <option data-content="<h5>Outros ...<h5>"></option>
                   </select>
                   </div>
                  </div>
<br>
  <div class="bg"id="wrapper" style="min-height: 575px;">
<div class="content ">
      <div class="row">
          <div class="col-md-3">
              <div class="specpanel">
                  <div class="panel-body">
                      <div class="text-center">
                  </div>
              </div>
          </div>
       </div>
   </div>
</div>
<div class="container">
      <div class="row">
          <div class="col-12">
              <div class="card shadow p-3 mb-5 bg-white rounded">
                  <div class="card-header">
                      <h2 class="text-center">Receita Definida</h2>
                  </div>
                  <div class="card-body ">
                      <h3 class="no-margins font-extra-bold text-success text-center" style="font-size:45px; color:#a94442;">R$ {{receita|floatformat:2}}</h3>

                  </div>
              </div>
          </div>
      </div>
</div>
<br>
      <div class="row">
          <div class="col-lg-4 text-center">
            <div class="card shadow p-3 mb-5 bg-white rounded ">
              <div class="card-body">
                      <div class="specpanel stats">
                          <div class="panel-body h-200">
                              <div class="stats-icon pull-right">
                                  <i class="fa fa-line-chart fa-2x"></i>
                              </div>
                              <div class="m-t-xl">
                           <span class="font-bold no-margins" style="text-transform:uppercase; font-size:20px;">
                             Qual Meta de Reantabilidade devemos definir ?
                           </span>
                           <br>
                                <div align=center>
                                   <input type="number" class="form-control" id="meta_rentabilidade" oninput="update_receita_estimada()" value="{{rentabilidade_percentage | floatformat:0}}" placeholder="Meta de Rentabilidade" style="width: 90%; display: inline; text-align: center;"> %
                                </div>
                              </div>
                          </div>
                      </div>
              </div>
            </div>
          </div>
           <div class="col-lg-4 text-center">
            <div class="card  bg-transparent border-light">
              <div class="card-body">
                      <div class="specpanel stats">
                          <div class="panel-body h-200">
                              <div class="stats-icon pull-right">
                              </div>
                              <div class="m-t-xl">
                           <span ><span>
                              </div>
                          </div>
                      </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4 text-center">
            <div class="card shadow p-3 mb-5 bg-white rounded ">
              <div class="card-body">
                      <div class="specpanel stats">
                          <div class="panel-body h-200">
                              <div class="stats-icon pull-right">
                                  <i class="fa fa-line-chart fa-2x"></i>
                              </div>
                              <div class="m-t-xl">
                                  <span class="font-bold no-margins" style="text-transform:uppercase; font-size:20px;">
                              Qual meta de Lucro Operacional (EBITDA) ?
                          </span>
                          <br>
                          <br>
                            <div align=center>
                                   <input type="number" class="form-control" id="meta_ebitda" oninput="update_receita_estimada()" value="{{ebitda_percentage | floatformat:0}}" placeholder="Meta de Ebitda" style="width: 90%; display: inline; text-align: center;"> %
                              </div>
                            </div>
                          </div>
                      </div>
              </div>
            </div>
          </div>
             <div class="col-lg-4 text-center">
            <div class="card shadow p-3 mb-5 bg-white rounded ">
              <div class="card-body">
                      <div class="specpanel stats">
                          <div class="panel-body h-200">
                              <div class="stats-icon pull-right">
                                  <i class="fa fa-line-chart fa-2x"></i>
                              </div>
                              <div class="m-t-xl">
                           <span class="font-bold no-margins" style="text-transform:uppercase; font-size:20px;">
                              Veja como ficou a meta de Rentabilidade
                          </span>
                                  <h3 id="receita_atualizada" class="no-margins font-extra-bold text-success" style="font-size:37px; color:#a94442;">R$ {{ receita_ | floatformat:2 }}</h3>
                              </div>
                          </div>
                      </div>
              </div>
            </div>
          </div>
             <div class="col-lg-4 text-center">
            <div class="card  bg-transparent border-light">
              <div class="card-body">
                      <div class="specpanel stats">
                          <div class="panel-body h-200">
                              <div class="stats-icon pull-right">
                              </div>
                              <div class="m-t-xl">
                           <span ><span>
                              </div>
                          </div>
                      </div>
              </div>
            </div>
          </div>
             <div class="col-lg-4 text-center">
            <div class="card shadow p-3 mb-5 bg-white rounded ">
              <div class="card-body">
                      <div class="specpanel stats">
                          <div class="panel-body h-200">
                              <div class="stats-icon pull-right">
                                  <i class="fa fa-line-chart fa-2x"></i>
                              </div>
                              <div class="m-t-xl">
                           <span class="font-bold no-margins" style="text-transform:uppercase; font-size:20px;">
                              Veja como ficou a meta de Lucro Operacional
                          </span>
                                  <h3 id="ebitda_atualizada" class="no-margins font-extra-bold text-success" style="font-size:37px; color:#a94442;">R$ {{ebitda_|floatformat:2}}</h3>
                              </div>
                          </div>
                      </div>
              </div>
            </div>
          </div>
  <div class="container clearfix tl-Spacing">
      <div class="card-responsive col-lg-12 text-center "">
          <div class="card-responsive card shadow-lg p-2 mb-5 rounded">
                  <div class="overflow-auto">
                    <div class="sticky-top">
                        <table class="table table--light table-dre dre-table::after">
                          <br>
 <table id="example" class="stripe row-border order-column" style="width:100%">

   <table class="table table-responsive">
    <thead class="thead-dark col-lg-8">
      <tr>
        <th scope="col-lg-4">Análise de Receita</th>
        <th scope="col-lg-4">Resultado</th>
        <th scope="col-lg-4">Análise </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>O Lucro líquido foi de</td>
        <td>R$ {{ lucro_liquido | floatformat:2 }}</td>
        <td>
          <select onchange="update_receita_estimada()" id="smile_lucro_liquido" class="selectpicker col-lg-12">
            {% for smile in smiles.smile_lucro_liquido %}
              {{smile|safe}}
            {% endfor %}
        </select>
        </td>

      </tr>
      <tr>
        <td>A rentabilidade média nos últimos anos foi de</td>
        <td>{{ rentabilidade_media | floatformat:2 }} %</td>
        <td>
          <select onchange="update_receita_estimada()" id="smile_rentabilidade_media" class="selectpicker col-lg-12">
            {% for smile in smiles.smile_rentabilidade_media %}
              {{smile|safe}}
            {% endfor %}
        </select>
        </td>
      </tr>
      <tr>
        <td>A rentabilidade no último ano foi de</td>
        <td>{{ rentabilidade | floatformat:2 }} %</td>
        <td>
          <select onchange="update_receita_estimada()" id="smile_rentabilidade_ultimo" class="selectpicker col-lg-12">
            {% for smile in smiles.smile_rentabilidade_ultimo %}
              {{smile|safe}}
            {% endfor %}
        </select>
        </td>
      </tr>
      <tr>
        <td>A rentabilidade no último ano comparada com o ano anterior aumentou em </td>
        <td>{{ rentabilidade_comparada | floatformat:2 }} %</td>
        <td>
          <select onchange="update_receita_estimada()" id="smile_rentabilidade_comparada" class="selectpicker col-lg-12">
            {% for smile in smiles.smile_rentabilidade_comparada %}
              {{smile|safe}}
            {% endfor %}
        </select>
        </td>
      </tr>
      <tr>
        <td>O EBITDA médio nos últimos anos foi de</td>
        <td>R$ {{ ebitda_medio | floatformat:2 }}</td>
        <td>
          <select onchange="update_receita_estimada()" id="smile_ebitda_medio" class="selectpicker col-lg-12">
            {% for smile in smiles.smile_ebitda_medio %}
              {{smile|safe}}
            {% endfor %}
        </select>
        </td>
      </tr>
      <tr>
        <td>O EBITDA no último ano foi de </td>
        <td>R$ {{ ebitda | floatformat:2 }}</td>
        <td>
          <select onchange="update_receita_estimada()" id="smile_ebitda_ultimo" class="selectpicker col-lg-12">
            {% for smile in smiles.smile_ebitda_ultimo %}
              {{smile|safe}}
            {% endfor %}
        </select>
        </td>
      </tr>
      <tr>
        <td style="color:white">_______________________________________________________________________________</td>
        <td style="color:white">_________________________________________</td>
        <td style="color:white">_______________________</td>
      </tr>

    </tbody>
  </table>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock content %}

{% block extras_js %}
<script type="text/javascript">
  function update_receita_estimada(){
    var selector_rentabilidade = document.getElementById("meta_rentabilidade");
    var selector_ebitda = document.getElementById("meta_ebitda");
    var receita_id = document.getElementById("receita_atualizada");
    var ebitda_id = document.getElementById("ebitda_atualizada");

    var data = {};

    smiles = ['smile_lucro_liquido', 'smile_rentabilidade_media', 'smile_rentabilidade_ultimo',
              'smile_rentabilidade_comparada', 'smile_ebitda_medio', 'smile_ebitda_ultimo'];
    for (i of smiles){
      smile = document.getElementById(i);
      data[i] = smile.options[smile.selectedIndex].value;
    };
    data['rentabilidade_percentage'] = parseFloat(selector_rentabilidade.value) / 100;
    data['ebitda_percentage'] = (parseFloat(selector_ebitda.value) / 100) + 1;

    $.ajax({
      type: "POST",
      url: './salvar/',
      data: data
    });

    // Atualização de campos
    nova_rentabilidade = parseFloat(selector_rentabilidade.value/100) * {{receita|unlocalize}};
    receita_id.innerHTML = nova_rentabilidade.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    nova_ebitda = ((parseFloat(selector_ebitda.value) / 100) + 1) * {{ebitda|unlocalize}};
    ebitda_id.innerHTML = nova_ebitda.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
  };
</script>
{% endblock extras_js %}
